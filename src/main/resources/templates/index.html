<!DOCTYPE html>
<html lang="ko" xmlns:th="www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{layout/header :: commonHead(title='KNU BookStore')}"></head>

<body>
    <nav th:replace="~{layout/header :: commonNav}"></nav>

    <div class="hero-section">
        <div class="container">
            <h1 class="hero-title">KNU BookStore</h1>
            <p class="hero-subtitle">당신의 인생을 바꿀 한 권의 책, 마당서점에서 만나보세요.</p>
            
            <div class="search-container">
                <form action="/list" method="get">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text bg-white border-0"><i class="bi bi-search text-muted"></i></span>
                        <input type="text" name="keyword" class="form-control border-0" 
                               placeholder="도서명, 저자, 출판사를 입력하세요" aria-label="Search">
                        <button class="btn btn-primary px-4" type="submit">검색하기</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        
        <div class="row g-4 mb-5 quick-menu-row">
            <div class="col-md-4">
                <div class="feature-box">
                    <i class="bi bi-truck feature-icon"></i>
                    <h4>빠른 무료 배송</h4>
                    <p class="text-muted mb-0">오후 2시 이전 주문 시<br>당일 발송해 드립니다.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-box">
                    <i class="bi bi-book-half feature-icon"></i>
                    <h4>방대한 도서</h4>
                    <p class="text-muted mb-0">베스트셀러부터 전문서적까지<br>다양한 책을 보유하고 있습니다.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-box">
                    <i class="bi bi-shield-check feature-icon"></i>
                    <h4>안전한 결제</h4>
                    <p class="text-muted mb-0">최신 보안 시스템으로<br>고객님의 정보를 보호합니다.</p>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-5">
             <div class="col-md-4">
                <a href="/list" class="btn btn-outline-dark w-100 p-3 rounded-3 shadow-sm">
                    <i class="bi bi-list-ul me-2"></i> 전체 도서 목록
                </a>
            </div>
            
            <div class="col-md-4" sec:authroize="hasRole('ADMIN')">
                <a href="/addBook" class="btn btn-outline-success w-100 p-3 rounded-3 shadow-sm">
                    <i class="bi bi-plus-circle me-2"></i> 도서 등록하기
                </a>
            </div>

            <div class="col-md-4">
                <a href="/search" class="btn btn-outline-primary w-100 p-3 rounded-3 shadow-sm">
                    <i class="bi bi-globe me-2"></i> API 도서 검색
                </a>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-end mb-4">
            <div>
                <h3 class="section-title mb-0">✨ 신규 입고 도서</h3>
                <p class="text-muted small mt-2 mb-0">가장 최근에 들어온 따끈따끈한 신작들을 만나보세요.</p>
            </div>
            <a href="/list" class="btn btn-sm btn-light rounded-pill px-3">
                전체보기 <i class="bi bi-arrow-right ms-1"></i>
            </a>
        </div>

        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
            <div class="col" th:each="book, iterStat : ${latestBooks}" th:if="${iterStat.index < 8}">
                <div class="card h-100 book-card">
                    <a th:href="@{/bookid/{id}(id=${book.bookid})}" class="position-relative d-block overflow-hidden">
                        <img th:if="${book.coverImagePath != null and book.coverImagePath != ''}"
                             th:src="${book.coverImagePath}" alt="표지">
                        
                        <div th:if="${book.coverImagePath == null or book.coverImagePath == ''}" 
                             class="d-flex align-items-center justify-content-center bg-light text-muted"
                             style="height: 260px;">
                            <i class="bi bi-book" style="font-size: 3rem;"></i>
                        </div>
                    </a>
                    
                    <div class="card-body d-flex flex-column">
                        <a th:href="@{/bookid/{id}(id=${book.bookid})}" class="text-decoration-none">
                            <h5 class="book-title" th:text="${book.bookname}">책 제목</h5>
                        </a>
                        <p class="book-author" th:text="${book.author}">저자</p>
                        
                        <div class="mt-auto d-flex justify-content-between align-items-center border-top pt-3">
                            <span class="book-price" th:text="${#numbers.formatInteger(book.price, 0, 'COMMA')} + '원'"></span>
                            
                            <a th:if="${book.stock > 0}" th:href="@{/addOrder/{bookid}(bookid=${book.bookid})}" 
                               class="btn btn-sm btn-outline-primary rounded-circle p-2" title="바로 구매">
                                <i class="bi bi-bag-plus-fill"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-12 text-center py-5" th:if="${latestBooks == null or latestBooks.isEmpty()}">
                <div class="py-5 bg-light rounded-3">
                    <i class="bi bi-emoji-neutral fs-1 text-muted"></i>
                    <p class="mt-3 text-muted">등록된 최신 도서가 없습니다.</p>
                </div>
            </div>
        </div>

    </div>

    <th:block th:replace="~{layout/footer :: commonScripts}"></th:block>
    
    <script th:if="${param.error != null and param.error[0] == 'access_denied'}">
        alert("관리자만 접근할 수 있는 페이지입니다.");
        history.replaceState({}, null, "/");
    </script>
</body>
</html>