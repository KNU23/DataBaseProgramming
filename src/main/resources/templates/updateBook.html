<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org">

<head th:replace="~{layout/header :: commonHead(title='도서정보 수정')}"></head>

<body>
    <nav th:replace="~{layout/header :: commonNav}"></nav>

    <div class="container mt-5" style="max-width: 700px;">
        <h2>도서정보 수정</h2>
        <hr>
        
        <!-- 1. enctype="multipart/form-data" 추가 -->
        <!-- 2. th:object="${bookDetail}"로 변경 (컨트롤러와 일치) -->
        <form th:action="@{/goUpdate/{id}(id=${bookDetail.bookid})}" method="post" th:object="${bookDetail}" enctype="multipart/form-data">
            
            <!-- Book ID (수정 불가) -->
            <div class="mb-3">
                <label for="bookid" class="form-label">Book ID (수정 불가)</label>
                <input type="text" id="bookid" class="form-control" th:field="*{bookid}" readonly disabled>
                <!-- 폼 전송을 위한 hidden ID -->
                <input type="hidden" th:field="*{bookid}" />
            </div>
            
            <!-- 3. 기존 이미지 경로 (파일 미선택 시 이 값 유지) -->
            <input type="hidden" th:field="*{coverImagePath}" />

            <!-- 책 제목 -->
            <div class="mb-3">
                <label for="bookname" class="form-label">책 제목</label>
                <input type="text" id="bookname" th:field="*{bookname}" class="form-control"
                       th:classappend="${#fields.hasErrors('bookname')} ? 'is-invalid' : ''">
                <div th:if="${#fields.hasErrors('bookname')}" th:errors="*{bookname}" class="invalid-feedback"></div>
            </div>
            
            <!-- 출판사 -->
            <div class="mb-3">
                <label for="publisher" class="form-label">출판사</label>
                <input type="text" id="publisher" th:field="*{publisher}" class="form-control"
                       th:classappend="${#fields.hasErrors('publisher')} ? 'is-invalid' : ''">
                <div th:if="${#fields.hasErrors('publisher')}" th:errors="*{publisher}" class="invalid-feedback"></div>
            </div>
            <!-- 저자 -->
            <div class="mb-3">
                <label for="author" class="form-label">저자</label>
                <input type="text" id="author" th:field="*{author}" class="form-control"
                       th:classappend="${#fields.hasErrors('author')} ? 'is-invalid' : ''">
                <div th:if="${#fields.hasErrors('author')}" th:errors="*{author}" class="invalid-feedback"></div>
            </div>
            <!-- 가격/재고 -->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="price" class="form-label">책 가격</label>
                    <input type="number" id="price" th:field="*{price}" class="form-control"
                           th:classappend="${#fields.hasErrors('price')} ? 'is-invalid' : ''">
                    <div th:if="${#fields.hasErrors('price')}" th:errors="*{price}" class="invalid-feedback"></div>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="stock" class="form-label">재고</label>
                    <input type="number" id="stock" th:field="*{stock}" class="form-control"
                           th:classappend="${#fields.hasErrors('stock')} ? 'is-invalid' : ''">
                    <div th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}" class="invalid-feedback"></div>
                </div>
            </div>
            
            <!-- 4. 도서 표지 이미지 파일 입력 -->
            <div class="mb-3">
                <label for="coverImageFile" class="form-label">
                    도서 표지 (새 이미지 등록)
                </label>
                <!-- 5. 현재 이미지 미리보기 -->
                <div th:if="*{coverImagePath != null and coverImagePath != ''}" class="mb-2">
                    <img th:src="*{coverImagePath}" alt="Current Cover" class="img-thumbnail" style="max-height: 150px;">
                </div>
                <input type="file" id="coverImageFile" th:field="*{coverImageFile}" class="form-control" accept="image/*">
                <small class="form-text text-muted">새 이미지를 등록하지 않으면 기존 이미지가 유지됩니다.</small>
            </div>

            <!-- 도서 설명 -->
            <div class="mb-3">
                <label for="description" class="form-label">도서 설명</label>
                <textarea id="description" th:field="*{description}" class="form-control" rows="5"></textarea>
            </div>
            
            <hr>
            
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" onclick="goList()">
                    <i class="bi bi-list-ul"></i> 목록으로
                </button>
                <!-- 6. type="submit"으로 변경 (JS대신 폼 전송) -->
                <button type="submit" class="btn btn-success">
                    <i class="bi bi-check-lg"></i> 수정 완료
                </button>
            </div>
        </form>
    </div>

    <th:block th:replace="~{layout/footer :: commonScripts}"></th:block>

    <script th:inline="javascript">
        /*<![CDATA[*/
        // '목록으로' 버튼
        const goList = () => {
            location.href = "/list";
        }
        /*]]>*/
    </script>
</body>
</html>

