<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Admin">

    <select id="countUsers" resultType="int">
        SELECT COUNT(*) FROM customer
    </select>

    <select id="countBooks" resultType="int">
        SELECT COUNT(*) FROM book
    </select>

    <select id="countOrders" resultType="int">
        SELECT COUNT(*) FROM orders WHERE status = 'ORDERED'
    </select>

    <select id="totalRevenue" resultType="long">
        SELECT IFNULL(SUM(total_price), 0) FROM orders WHERE status = 'ORDERED'
    </select>

    <select id="getDailySales" resultType="com.example.demo.dto.DashboardDTO">
        SELECT DATE_FORMAT(orderdate, '%Y-%m-%d') AS label,
               SUM(total_price) AS value
          FROM orders
         WHERE status = 'ORDERED'
           AND orderdate >= DATE_SUB(NOW(), INTERVAL 7 DAY)
      GROUP BY DATE_FORMAT(orderdate, '%Y-%m-%d')
      ORDER BY label ASC
    </select>

    <select id="getTopSellingBooks" resultType="com.example.demo.dto.DashboardDTO">
        SELECT b.bookname AS label,
               SUM(od.count) AS value
          FROM order_details od
          JOIN book b ON od.bookid = b.bookid
          JOIN orders o ON od.orderid = o.orderid
         WHERE o.status = 'ORDERED'
      GROUP BY b.bookid
      ORDER BY value DESC
         LIMIT 5
    </select>

</mapper>